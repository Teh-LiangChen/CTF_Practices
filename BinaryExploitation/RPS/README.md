# Writeup: RPS

## Overview

This challenge requires an understanding of the C language, especially the `strstr` function

## Analysis

### Code Overview

- The program create two arrays, `hands` and `loses`, where `hands` represents the program's choices (rock,paper,scissors), and `loses` represents the respective move that defeats it.

- The program also initialises a `wins` variable to count number of wins by user.

```c
char* hands[3] = {"rock", "paper", "scissors"};
char* loses[3] = {"paper", "scissors", "rock"};
int wins = 0;
```

- In the `main` function, if `play` function return `true`, the `wins` counter increases by one.

- When the `wins` counter is greater or equal to 5, the program outputs a flag. Thus, the goal is to understand the condition under which the `play` function returns true.

```c
int main () {
  char input[3] = {'\0'};
  int command;
  int r;

  puts("Welcome challenger to the game of Rock, Paper, Scissors");
  puts("For anyone that beats me 5 times in a row, I will offer up a flag I found");
  puts("Are you ready?");
  
  while (true) {
    puts("Type '1' to play a game");
    puts("Type '2' to exit the program");
    r = tgetinput(input, 3);
    // Timeout on user input
    if(r == -3)
    {
      printf("Goodbye!\n");
      exit(0);
    }
    
    if ((command = strtol(input, NULL, 10)) == 0) {
      puts("Please put in a valid number");
      
    } else if (command == 1) {
      printf("\n\n");
      if (play()) {
        wins++;
      } else {
        wins = 0;
      }

      if (wins >= 5) {
        puts("Congrats, here's the flag!");
        puts(flag);
      }
    } else if (command == 2) {
      return 0;
    } else {
      puts("Please type either 1 or 2");
    }
  }

  return 0;
}
```


- In the `play` function, the line `if (strstr(player_turn, loses[computer_turn]))` must return true to win

- The `player_turn` is user input, while `computer_turn` is generated randomly from 0 to 2, determining the string in `loses` array.

- So we need to know the function of `strstr`.

```c
bool play () {
  char player_turn[100];
  srand(time(0));
  int r;

  printf("Please make your selection (rock/paper/scissors):\n");
  r = tgetinput(player_turn, 100);
  // Timeout on user input
  if(r == -3)
  {
    printf("Goodbye!\n");
    exit(0);
  }

  int computer_turn = rand() % 3;
  printf("You played: %s\n", player_turn);
  printf("The computer played: %s\n", hands[computer_turn]);

  if (strstr(player_turn, loses[computer_turn])) {
    puts("You win! Play again?");
    return true;
  } else {
    puts("Seems like you didn't win this time. Play again?");
    return false;
  }
}
```

- By reading the documentation of `strstr` function using the command `man strstr` in terminal, we know that the program checks whether the user input `player_turn` contains the substring `loses[computer_turn]`.

```terminal
$ man strstr
```

### Vulnerabilities

- There are no vulnerabilities in the program. it requires an understanding of the C language.

### Exploitation Strategy

- Since the program checks whether our input contains the substring of `loses[computer_turn]`, we can easily exploit it by inputting `rockpaperscissors` five times to get the flag.

### Exploitation Steps

```terminal
$ nc saturn.picoctf.net 61681
1
rockpaperscissors
rockpaperscissors
rockpaperscissors
rockpaperscissors
rockpaperscissors
```

```Example Output
Please make your selection (rock/paper/scissors):
rockpaperscissors
rockpaperscissors
You played: rockpaperscissors
The computer played: scissors
You win! Play again?
Congrats, here's the flag!
picoCTF{50M3_3X7R3M3_1UCK_58F0F41B}
Type '1' to play a game
Type '2' to exit the program
```

## Conclusion

- This challenge basically requires an understanding of C language to exploit it.
